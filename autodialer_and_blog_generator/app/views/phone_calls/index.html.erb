<h1><i class="fas fa-phone-alt"></i> AI Phone Dialer</h1>

<!-- AI Command Interface -->
<div class="card mb-4 border-primary">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0"><i class="fas fa-brain"></i> AI Command Interface</h5>
  </div>
  <div class="card-body">
    <p>Use natural language to make calls. Examples:</p>
    <ul>
      <li>"Make a call to +18001234567"</li>
      <li>"Call +18005551234 and tell them about our special offer"</li>
    </ul>
    <%= form_with url: ai_command_phone_calls_path, method: :post, local: true do |f| %>
      <div class="mb-3">
        <%= f.text_area :command, class: "form-control", rows: 3, placeholder: "Type your command here...", required: true %>
      </div>
      <%= f.submit "Execute AI Command", class: "btn btn-primary" %>
    <% end %>
  </div>
</div>

<!-- Statistics -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h3 class="text-primary"><%= @stats[:total] %></h3>
        <p class="text-muted mb-0">Total Calls</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h3 class="text-success"><%= @stats[:successful] %></h3>
        <p class="text-muted mb-0">Successful</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h3 class="text-danger"><%= @stats[:failed] %></h3>
        <p class="text-muted mb-0">Failed</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h3 class="text-warning"><%= @stats[:pending] %></h3>
        <p class="text-muted mb-0">Pending</p>
      </div>
    </div>
  </div>
</div>

<!-- Add New Calls Button -->
<div class="mb-3 d-flex gap-2">
  <%= link_to "Make New Calls", new_phone_call_path, class: "btn btn-success btn-lg" %>
  <%= button_to "Refresh All Call Status", refresh_all_phone_calls_path, method: :post, class: "btn btn-info", data: { confirm: "This will update status for all active calls. Continue?" } %>
</div>

<!-- Calls List -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">Call Log</h5>
  </div>
  <div class="card-body">
    <% if @phone_calls.any? %>
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Phone Number</th>
              <th>Status</th>
              <th>Duration</th>
              <th>Call SID</th>
              <th>Error</th>
              <th>Created At</th>
            </tr>
          </thead>
          <tbody>
            <% @phone_calls.each do |call| %>
              <tr>
                <td><%= call.phone_number %></td>
                <td>
                  <span class="badge <%= call.status == 'completed' ? 'bg-success' : call.status == 'failed' ? 'bg-danger' : 'bg-warning' %>">
                    <%= call.status %>
                  </span>
                </td>
                <td><%= call.duration ? "#{call.duration}s" : '-' %></td>
                <td><small><%= call.call_sid || '-' %></small></td>
                <td><small class="text-danger"><%= call.error_message || '-' %></small></td>
                <td><%= call.created_at.strftime("%Y-%m-%d %H:%M") rescue '-' %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted text-center py-4">No calls have been made yet. Click "Make New Calls" to get started!</p>
    <% end %>
  </div>
</div>
